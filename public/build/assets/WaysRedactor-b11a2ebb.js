import{d as $,o as n,c as d,j as z,v as M,a as s,n as w,C as m,g as N,h as S,i as B,f as v,w as C,t as D,B as b,e as g,m as V,V as T,F as Y,k as R,r as j,b as O,u as I}from"./app-59cce0b0.js";import{W as P,h as q}from"./Wialon-8d7075fe.js";import{L as F,_ as U}from"./PreLoader.vue_vue_type_script_setup_true_lang-bb1b6e3a.js";const H={class:"flex-grow"},A=["disabled"],G=$({__name:"OrderNameInput",props:["pageData","order"],setup(o){const i=o;return(e,r)=>(n(),d("div",H,[z(s("input",{type:"text",disabled:i.pageData.editable!=o.order,"onUpdate:modelValue":r[0]||(r[0]=u=>i.order.name=u),class:"w-full h-full bg-gray-100 px-2 rounded outline-none disabled:bg-transparent",required:""},null,8,A),[[M,i.order.name]])]))}}),J={class:"flex gap-1.5"},K=s("button",{type:"submit",class:"w-7 h-7 text-sm bg-teal-500/20 text-teal-900 rounded active:bg-teal-500/50 hover:bg-teal-500/30"},[s("i",{class:"fa-solid fa-floppy-disk"})],-1),Q=s("i",{class:"fa-duotone fa-solid fa-trash"},null,-1),X=[Q],Z=$({__name:"NewOrderEvents",emits:["delete"],setup(o,{emit:i}){const e=i;return(r,u)=>(n(),d("div",J,[K,s("button",{onClick:u[0]||(u[0]=c=>e("delete")),type:"button",class:"w-7 h-7 text-sm bg-red-500/15 text-red-900 rounded active:bg-red-500/50 hover:bg-red-500/30"},X)]))}}),ee={class:"flex gap-1.5"},te=["disabled"],se=s("i",{class:"fa-solid fa-map"},null,-1),ae=[se],le={key:0,type:"submit",class:"w-7 h-7 text-sm bg-teal-500/15 text-teal-900 rounded active:bg-teal-500/50 hover:bg-teal-500/30"},oe=s("i",{class:"fa-solid fa-floppy-disk"},null,-1),ne=[oe],de=s("i",{class:"fa-solid fa-pencil"},null,-1),ie=[de],re=s("i",{class:"fa-duotone fa-solid fa-trash"},null,-1),ce=[re],ue=$({__name:"ExistOrderEvents",props:["pageData","order"],emits:["deleteOrderWay","editExistsOrder","selectedWayChange"],setup(o,{emit:i}){const e=o,r=i;return(u,c)=>(n(),d("div",ee,[s("button",{type:"button",onClick:c[0]||(c[0]=h=>r("selectedWayChange")),disabled:e.pageData.selectedLoading==e.order,class:w([[e.pageData.selectedLoading==o.order?"bg-teal-900 text-white":"bg-teal-500/15 text-teal-900 active:bg-teal-500/50 hover:bg-teal-500/30"],"w-7 h-7 text-sm rounded"])},ae,10,te),e.pageData.editable==e.order?(n(),d("button",le,ne)):(n(),d("button",{key:1,type:"button",onClick:c[1]||(c[1]=h=>r("editExistsOrder")),class:"w-7 h-7 text-sm bg-teal-500/15 text-teal-900 rounded active:bg-teal-500/50 hover:bg-teal-500/30"},ie)),s("button",{onClick:c[2]||(c[2]=h=>r("deleteOrderWay")),type:"button",class:"w-7 h-7 text-sm bg-red-500/15 text-red-900 rounded active:bg-red-500/50 hover:bg-red-500/30"},ce)]))}}),_="api/orderway";async function fe(){return await m.get(_)}async function be(o){return await m.get(`${_}/${o}`)}async function ge(o){return m.post(_,o)}async function pe(o,i){return m.put(`${_}/${o}`,i)}async function me(o){return m.post(`${_}/${o.id}/update-name`,o)}async function _e(o){return m.delete(`${_}/${o}`)}const p={index:fe,store:ge,update:pe,destroy:_e,updateName:me,show:be},xe={class:"h-full flex fixed inset-0"},he=s("i",{class:"fa-duotone fa-house"},null,-1),ye={class:"absolute top-3 right-20 text-xl text-teal-600 z-[1000] font-semibold"},ve=s("i",{class:"fa-solid fa-xmark"},null,-1),we=[ve],$e=s("i",{class:"fa-solid fa-broom-wide"},null,-1),ke=[$e],Ce=s("i",{class:"fa-duotone fa-solid fa-trash"},null,-1),De=[Ce],Oe={key:0,class:"fa-solid fa-spinner fa-spin-pulse"},We={key:1},Le=s("i",{class:"fa-solid fa-floppy-disk ml-1.5"},null,-1),Ee=s("main",{class:"text-center text-white"},[s("h3",{class:"text-3xl mb-3 uppercase"},"Hisobotni tanlang"),s("span",{class:"text-6xl"},[s("i",{class:"fa-solid fa-map"})])],-1),ze=[Ee],Me={class:"p-2 z-50 h-full flex w-[420px] flex-col bg-white"},Ne=["disabled"],Se={class:"mt-1.5"},Be={class:""},Ve=["onSubmit"],Te={key:0,class:"px-2 mb-1.5"},Ye={class:"text-sm text-gray-400"},Pe=$({__name:"WaysRedactor",setup(o){const i=N(null),e=S({wialon:null,leaflet:null,loading:!1,selectedOrderWay:null,selectedLoading:null,orders:[],editable:null,selectedCircle:null});function r(){e.orders.unshift({name:"",edit:null}),e.editable=e.orders[0]}async function u(a){await p.destroy(a.id);const t=e.orders.findIndex(f=>f==a);e.orders.splice(t,1),e.editable==a&&(e.editable=null)}function c(a){e.orders=e.orders.filter(t=>t.id!==void 0),e.editable=a}async function h(a,t){if(a.preventDefault(),t.id===void 0){const{data:f}=await p.store(t);e.editable=null;const y=e.orders.findIndex(l=>l==t);e.orders[y]=f}else p.updateName(t),e.editable=null}function k(){var a;(a=e.leaflet)==null||a.clearDrawLinePoints()}async function W(){if(e.selectedOrderWay==null)return console.log("tanlang");e.loading=!0;const a=e.leaflet.geetDrawPoints();p.update(e.selectedOrderWay.id,a),setTimeout(()=>e.loading=!1,2e3)}async function L(a){k(),e.selectedLoading=a;const{data:t}=await p.show(a.id);e.selectedOrderWay=null,setTimeout(()=>{var f;e.selectedOrderWay=a,(f=e.leaflet)==null||f.reDrawLinesBase(t.points)},500)}function E(){e.selectedLoading=null,e.selectedOrderWay=null,k()}return B(async()=>{const{data:a}=await p.index();e.orders=a,e.leaflet=new F(i.value,2),e.wialon=new P(e.leaflet.map),e.leaflet.onClearSelectCircle=function(){e.selectedCircle=!1},e.leaflet.onSelectCircle=function(){e.selectedCircle=!0}}),(a,t)=>{var y;const f=j("RouterLink");return n(),d("section",xe,[v(U,{loading:e.loading},null,8,["loading"]),v(f,{to:"/",class:"fixed left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:C(()=>[he]),_:1}),s("div",{ref_key:"geozonemap",ref:i,class:"h-full flex-grow relative z-40"},[s("h3",ye,D((y=e.selectedOrderWay)==null?void 0:y.name),1),s("div",{onClick:t[1]||(t[1]=b(()=>{},["stop"])),onMousedown:t[2]||(t[2]=b(()=>{},["stop"])),class:w([[e.selectedOrderWay!=null?"right-0":"-right-12"],"z-[1000] cursor-auto absolute bottom-0 top-0 transition-all bg-gray-50 p-2 shadow-inner border-r border-teal-400 flex flex-col gap-2"])},[s("button",{onClick:t[0]||(t[0]=l=>E()),class:"w-8 h-8 text-sm bg-red-300/20 shadow text-red-900 rounded active:bg-red-500/50 hover:bg-red-500/30"},we),s("button",{onClick:k,class:"w-8 h-8 text-sm bg-teal-300/20 shadow text-teal-900 rounded active:bg-teal-500/50 hover:bg-teal-500/30"},ke)],34),s("div",{onClick:t[6]||(t[6]=b(()=>{},["stop"])),onMousedown:t[7]||(t[7]=b(()=>{},["stop"])),class:w([[e.selectedOrderWay!=null?"bottom-0":"-bottom-10"],"z-[1000] justify-end cursor-auto absolute right-12 transition-all p-2 gap-2 flex"])},[e.selectedCircle?(n(),d("button",{key:0,onClick:t[3]||(t[3]=l=>e.leaflet.changeColorDrawLine("green")),class:"w-8 h-8 rounded-full border border-green-600 bg-teal-400/60 active:bg-teal-500/50 hover:bg-teal-500/30"})):g("",!0),e.selectedCircle?(n(),d("button",{key:1,onClick:t[4]||(t[4]=l=>e.leaflet.changeColorDrawLine("red")),class:"w-8 h-8 rounded-full border border-rose-600 bg-red-400/80 active:bg-red-500/50 hover:bg-red-500/30"})):g("",!0),e.selectedCircle?(n(),d("button",{key:2,onClick:t[5]||(t[5]=(...l)=>e.leaflet.deleteDrawLine&&e.leaflet.deleteDrawLine(...l)),class:"w-8 h-8 rounded uppercase bg-red-400/40 text-red-900 font-bold active:bg-red-500/50 hover:bg-red-500/30 mx-5"},De)):g("",!0),e.selectedCircle?g("",!0):(n(),d("button",{key:3,onClick:W,class:"w-24 py-1.5 rounded uppercase bg-teal-400/40 text-teal-900 font-bold active:bg-teal-500/50 hover:bg-teal-500/30"},[e.loading?(n(),d("i",Oe)):(n(),d("span",We,[V("Saqlash "),Le]))]))],34),v(T,null,{default:C(()=>[e.selectedOrderWay==null?(n(),d("div",{key:0,onClick:t[8]||(t[8]=b(()=>{},["stop"])),onMousedown:t[9]||(t[9]=b(()=>{},["stop"])),class:"absolute inset-0 z-[2000] bg-teal-600/90 flex justify-center items-center"},ze,32)):g("",!0)]),_:1})],512),s("div",Me,[s("button",{disabled:e.editable!=null,onClick:t[10]||(t[10]=l=>r()),class:"bg-teal-500/20 text-teal-900 rounded py-1 font-semibold active:bg-teal-500/50 hover:bg-teal-500/30 disabled:bg-gray-200"}," Yangi hisobot ",8,Ne),s("ul",Se,[(n(!0),d(Y,null,R(e.orders,l=>(n(),d("li",Be,[s("form",{onSubmit:x=>h(x,l),class:w([{"mb-1.5":l.id===void 0},"flex gap-1.5"])},[v(G,{pageData:e,order:l},null,8,["pageData","order"]),l.id===void 0?(n(),O(Z,{key:0,onDelete:x=>u(l)},null,8,["onDelete"])):(n(),O(ue,{key:1,pageData:e,order:l,onDeleteOrderWay:x=>u(l),onEditExistsOrder:x=>c(l),onSelectedWayChange:x=>L(l)},null,8,["pageData","order","onDeleteOrderWay","onEditExistsOrder","onSelectedWayChange"]))],42,Ve),l.id?(n(),d("main",Te,[s("span",Ye,D(I(q)(l.created_at).format("DD-MM-YYYY")),1)])):g("",!0)]))),256))])])])}}});export{Pe as default};
