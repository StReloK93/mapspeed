import{G as k,d as w,e as u,g as D,o as h,c as m,f as C,r as v,b as g,w as L,a as c,t as W}from"./app-ce6a0468.js";import{h as f,W as z}from"./Wialon-fdf32d97.js";import{H as Y}from"./highcharts-ba9c9956.js";import{L as S,_ as M}from"./PreLoader.vue_vue_type_script_setup_true_lang-ac9f4858.js";import{a as R}from"./TimezoneDate-18da9230.js";import"./_commonjsHelpers-de833af9.js";async function T(_){const{data:s}=await k.post("api/get_way_speed",_);return s}const V={getWaysSpeed:T},P=w({__name:"ChartLine",setup(_,{expose:s}){function p(o){const t=new Date(o);return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes())}function d(o){o&&i.value.series[0].setData(o.map(t=>({y:t.average_speed,x:p(t.hour)})))}const e=u(),i=u(null),l={accessibility:{enabled:!1},chart:{backgroundColor:"transparent",type:"spline",scrollablePlotArea:{}},title:null,subtitle:null,xAxis:{gridLineColor:"transparent",gridLineWidth:0,lineWidth:0,minorGridLineWidth:10,type:"datetime",labels:{overflow:"justify"}},yAxis:{min:0,max:50,title:null,minorGridLineWidth:0,gridLineWidth:0,alternateGridColor:null},tooltip:{valueSuffix:" Km/s"},plotOptions:{spline:{lineWidth:4,states:{hover:{lineWidth:5}},marker:{enabled:!1},pointInterval:36e5,pointStart:Date.UTC(2020,3,15,0,0,0)}},series:[{name:"Tezlik smena bo'yicha",data:[]}],navigation:{menuItemStyle:{fontSize:"10px"}}};return s({getChartData:d}),D(()=>{i.value=Y.chart(e.value,l)}),(o,t)=>(h(),m("main",{class:"h-64 w-full",ref_key:"chartLine",ref:e},null,512))}}),G={class:"fixed inset-0"},U=c("i",{class:"fa-duotone fa-house"},null,-1),A={class:"absolute top-0 right-0 p-2 z-50 flex w-96 flex-col bg-blue-200/50 rounded-b-2xl"},B={class:"text-center text-xl"},I={key:0,class:"fa-sharp fa-regular fa-spinner fa-spin-pulse"},O={key:1},E=w({__name:"WaysPage",setup(_){const s=u(),p=R(f()),d=u(0),e=C({currentDate:p.date,wialon:null,geozones:null,leaflet:null,loading:!1,smena:p.smena}),i=u(),l=u({start:null,end:null});function o(){var a;i.value.getChartData([]),(a=e.leaflet)==null||a.rectanglesClear()}async function t(){e.loading=!0;const a=e.leaflet.getRectanglePoints(),n=await V.getWaysSpeed({startDay:f(l.value.start).format("YYYY-MM-DD"),endDay:f(l.value.end).format("YYYY-MM-DD"),points:a}).catch(r=>{l.value.start==null&&l.value.end==null&&alert("Kunni tanlang"),a.length==0&&alert("Yo'lni tanlang"),e.loading=!1});if(n.length){const r=n.reduce((x,y)=>x+y.average_speed,0);d.value=Math.round(r/n.length)}else d.value=0;i.value.getChartData(n),e.loading=!1}async function b(a){e.loading=!0;const n=f(a).add(-6,"h").unix(),r=f(a).unix();await e.wialon.executeReport(7381,n,r),e.loading=!1}return D(async()=>{e.leaflet=new S(s.value,!0),e.wialon=new z(e.leaflet.map),e.wialon.onInit=()=>b(new Date)}),(a,n)=>{const r=v("RouterLink"),x=v("VDatePicker");return h(),m("section",G,[g(M,{loading:e.loading},null,8,["loading"]),g(r,{to:"/",class:"absolute left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:L(()=>[U]),_:1}),c("div",A,[c("button",{onClick:o,class:"bg-white px-4 py-1.5 rounded-full mb-2"},"Tozalash"),g(P,{ref_key:"chartLineRef",ref:i},null,512),c("div",B," O'rtacha tezlik: "+W(d.value),1),g(x,{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=y=>l.value=y),mode:"date",class:"my-2","is-range":"",expanded:""},null,8,["modelValue"]),c("button",{onClick:t,class:"px-4 py-1.5 rounded-full bg-blue-500 text-white"},[e.loading?(h(),m("i",I)):(h(),m("span",O,"Tasdiqlash"))])]),c("div",{ref_key:"geozonemap",ref:s,class:"h-full w-full z-40"},null,512)])}}});export{E as default};
