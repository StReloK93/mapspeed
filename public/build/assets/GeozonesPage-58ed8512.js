import{M as k,aM as D,aK as M,ax as C,u as i,I as _,bx as T,v as n,bz as Y,bo as R,F as E,aP as G,aR as H,aE as r,ao as $,b3 as b,bc as w,b6 as x}from"./app-4e4c38d2.js";import{h as c,L as j,W as B,_ as I}from"./Leaflet-9a1f6bbd.js";const V={class:"fixed inset-0"},F=n("i",{class:"fa-sharp fa-light fa-xmark"},null,-1),N={class:"absolute bottom-[105px] left-0 p-2 z-50"},O={class:"absolute left-0 bottom-0 z-50 w-full p-2"},P={class:"flex flex-wrap gap-1 justify-between px-6 items-center h-24 bg-white relative rounded-md shadow-md"},W=n("span",{class:"border-b w-full absolute top-1/2 left-0 border-gray-400"},null,-1),K={class:"inline-flex w-4 h-4 justify-center items-center relative z-20"},S=["onClick"],U={key:0,class:"text-[11px] font-bold relative -top-px"},q={key:1},A={key:0,class:"fa-solid fa-circle-small text-sm"},J={key:1,class:"fa-light fa-pipe text-[10px]"},ee=k({__name:"GeozonesPage",setup(Q){const f=D(),e=M({currentDate:c().format("YYYY-MM-DD"),wialon:null,geozones:null,leaflet:null,selected:null,loading:!1});async function y(a){const{data:o}=await axios.get(`api/get_geozones/${a}`),s=[];for(const t in o)s.push({dateTime:c(t).format("YYYY-MM-DD HH:mm"),points:o[t],zero:c(t).format("mm")=="00"});return s}const d=[];function z(){d.forEach(a=>{e.leaflet.map.removeLayer(a)})}function m(a){const o=e.geozones[a];v(o.dateTime),z(),e.geozones.length!=0&&(e.selected=a,o.points.forEach(s=>{const t=s.name,l={color:"#333",weight:3,fillColor:"red",fillOpacity:.5};if(s.points.length>1){const p=s.points.map(h=>[h.y,h.x]),u=L.polygon(p,l).addTo(x(e.leaflet.map));u.bindTooltip(t),d.push(u)}else{const p=s.points[0],u=L.circle([p.y,p.x],{radius:p.r,...l}).addTo(x(e.leaflet.map));u.bindTooltip(t),d.push(u)}}))}async function v(a){e.loading=!0;const o=c(a).add(-1.5,"h").unix(),s=c(a).unix();await e.wialon.executeReport(7381,o,s),e.loading=!1}async function g(){e.geozones=await y(e.currentDate),m(e.geozones.length-1)}return C(async()=>{e.leaflet=new j(f.value),e.wialon=new B(e.leaflet.map),e.wialon.onInit=()=>g()}),(a,o)=>{const s=H("RouterLink");return r(),i("section",V,[_(I,{loading:e.loading},null,8,["loading"]),_(s,{to:"/",class:"absolute right-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:T(()=>[F]),_:1}),n("div",N,[Y(n("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=t=>e.currentDate=t),onChange:o[1]||(o[1]=t=>g()),class:"px-4 py-1.5 rounded-full"},null,544),[[R,e.currentDate]])]),n("aside",O,[n("main",P,[W,(r(!0),i(E,null,G(e.geozones,(t,l)=>(r(),i("span",K,[n("button",{onClick:p=>m(l),class:$([{"!bottom-4":l%2==1,"top-4":l%2==0,"text-xs w-7 h-7 bg-gray-200":t.zero==!1,"w-9 h-9 bg-gray-300":t.zero,"!bg-blue-600 text-white":e.selected==l},"absolute rounded-full hover:bg-gray-100 active:bg-gray-50 shadow-sm"])},[t.zero?(r(),i("span",U,b(w(c)(t.dateTime).format("HH:mm")),1)):(r(),i("span",q,b(w(c)(t.dateTime).format("mm")),1))],10,S),t.zero?(r(),i("i",A)):(r(),i("i",J))]))),256))])]),n("div",{ref_key:"geozonemap",ref:f,class:"h-full w-full z-40"},null,512)])}}});export{ee as default};
