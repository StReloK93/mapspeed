import{u as g}from"./Wialon-d02f08bb.js";import{d as m,o as c,p,w as u,c as f,y as _,T as w,a as v}from"./app-e9234c57.js";class b{constructor(e,t=!1){this.points=[],this.pivotLat=42.32,this.pivotLon=63.82,this.size=50,this.store=g(),this.map=this.createMap(e),this.rectangles=[],t&&this.map.on("click",this.handleMapClick.bind(this))}handleMapClick(e){const t=e.latlng.lat,s=e.latlng.lng,a=Math.floor((this.pivotLat-t)*111e3/this.size),i=Math.floor((s-this.pivotLon)*(111e3*Math.cos(this.deg2rad(this.pivotLat)))/this.size);if(!this.rectangleFind(a,i))console.log(a,i),this.drawSquare({ZonaX:a,ZonaY:i},this.size,1);else{const{rectangle:n}=this.rectangleFind(a,i);n.remove(),this.rectangleDelete(a,i)}}rectangleFind(e,t){return this.rectangles.find(s=>s.row===e&&s.column===t)}rectanglesClear(){this.rectangles.forEach(({rectangle:e})=>{e.remove()}),this.rectangles=[]}rectangleDelete(e,t){const s=this.rectangles.findIndex(a=>a.row===e&&a.column===t);this.rectangles.splice(s,1)}getRectanglePoints(){return this.rectangles.map(e=>({ZonaX:e.row,ZonaY:e.column}))}createMap(e){const t=wialon.core.Session.getInstance().getId(),s=wialon.core.Session.getInstance(),a=L.map(e,{zoomControl:!1}).setView([42.2628699,63.891215],12);L.TileLayer.WebGis=L.TileLayer.extend({initialize:function(n,o){this._url=`http://wl.ngmk.uz/gis_render/{x}_{y}_{z}/${o.userId}/tile.png?sid=${t}`},getTileUrl:i}),new L.TileLayer.WebGis(s.getBaseGisUrl("render"),{attribution:"NKMK SHKB",minZoom:1,userId:s.getCurrUser().getId()}).addTo(a);function i(n){return L.Util.template(this._url,L.extend({s:this._getSubdomain(n),z:17-n.z,x:n.x,y:n.y},this.options))}return a}drawSquare(e,t,s){const a=+e.ZonaX,i=+e.ZonaY,n=42.32,o=63.82,l=L.latLng(n-a*(t/111e3),o+i*(t/(111e3*Math.cos(this.deg2rad(n))))),h=L.latLng(n-(a+1)*(t/111e3),o+(i+1)*(t/(111e3*Math.cos(this.deg2rad(n))))),d=L.rectangle([l,h],{color:"red",weight:1,opacity:1,fillOpacity:.25}).addTo(this.map);this.rectangles.push({row:a,column:i,rectangle:d})}getCenterCubic(e,t){const s=(e.lat+t.lat)/2,a=(e.lng+t.lng)/2;return L.latLng(s,a)}drawCubics(e){e.forEach((t,s)=>{this.drawSquare(t,50,s+1)})}removeCubics(){this.points.forEach(e=>{this.map.removeLayer(e.rect),this.map.removeLayer(e.marker)}),this.store.points=[],this.points=[]}deg2rad(e){return e*(Math.PI/180)}fixedToPoint(e,t){this.store.points.forEach(s=>{s.image==t?(s.active=!0,s.image.classList.add("animate-marker")):(s.active=!1,s.image.classList.remove("animate-marker"))}),this.map.setView(e,15)}}const k={key:0,class:"bg-black/30 absolute inset-0 z-[100] flex justify-center items-center"},x=v("span",{class:"loader"},null,-1),y=[x],T=m({__name:"PreLoader",props:["loading"],setup(r){const e=r;return(t,s)=>(c(),p(w,null,{default:u(()=>[e.loading?(c(),f("div",k,y)):_("",!0)]),_:1}))}});export{b as L,T as _};
