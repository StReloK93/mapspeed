import{d as h,e as c,g as y,o as x,c as k,a as t,h as g,v as w,p as D,w as C,b as s,u as o,y as $,A as T,f as Y,r as V,n as b}from"./app-b0ddd7dd.js";import{h as p,W as z}from"./Wialon-8c026dc0.js";import{a as v,b as B,g as E}from"./TimezoneDate-412ca965.js";import{D as L,a as r,o as S,b as j}from"./data-grid-ff4cf149.js";import{L as H,_ as G}from"./PreLoader.vue_vue_type_script_setup_true_lang-9e6d0f83.js";import"./_commonjsHelpers-de833af9.js";const N={class:"flex justify-end items-center px-2 bg-slate-900 text-white"},R=t("i",{class:"fa-regular fa-xmark"},null,-1),U=[R],F={class:"flex-grow relative"},W={class:"absolute inset-0 overflow-y-auto"},A={class:"flex pt-2 px-2"},I={class:"flex flex-col mr-5"},P={class:"flex flex-col mr-5"},q=h({__name:"GrayderModal",setup(M){const m=c(),i=c([]),u=c(p().add(-1,"days").format("YYYY-MM-DD HH:ss")),a=c(p().format("YYYY-MM-DD HH:ss"));var _;m.value=new z(_);async function d(){i.value=[];const n=await m.value.greyderTable(10587,p(u.value).unix(),p(a.value).unix());for(const e in n)i.value.push({name:e,in_excavator:v(n[e].time_in_excavator),counts:n[e].counts.size,active:n[e].counts.size>0&&n[e].time_in_excavator>0,in_smena:v(n[e].in_smena),in_not_excavator_move:v(n[e].in_not_excavator_move),in_not_excavator_stop:v(n[e].in_not_excavator_stop)})}return y(async()=>{d()}),(n,e)=>(x(),k("section",{onMouseup:e[4]||(e[4]=l=>n.$emit("close")),class:"absolute inset-0 bg-black/40 z-[100] flex justify-center items-center p-10"},[t("main",{onMouseup:e[3]||(e[3]=T(()=>{},["stop"])),class:"bg-white w-full h-full rounded-md flex flex-col overflow-hidden"},[t("header",N,[t("div",null,[t("button",{onClick:e[0]||(e[0]=l=>n.$emit("close")),class:"w-10 h-10 flex justify-center items-center active:bg-white/15 hover:bg-white/25"},U)])]),t("main",F,[t("div",W,[t("div",A,[t("main",I,[g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l),type:"datetime-local",class:"h-8 bg-transparent"},null,512),[[w,u.value]])]),t("main",P,[g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.value=l),type:"datetime-local",class:"h-8 bg-transparent"},null,512),[[w,a.value]])]),t("button",{onClick:d,class:"px-2 bg-slate-900 text-white rounded-sm shadow-md"}," Выполнить ")]),i.value.length?(x(),D(o(j),{key:0,"data-source":i.value,onExporting:o(S)},{default:C(()=>[s(o(L),{enabled:!0,"allow-export-selected-data":!0}),s(o(r),{"data-field":"name",caption:"Техника",width:"120"}),s(o(r),{"data-field":"active",caption:"Статус"}),s(o(r),{"data-field":"counts",caption:"Количество зачищенных забоев"}),s(o(r),{"data-field":"in_excavator",caption:"Время в геозоне ЭКС (мин)"}),s(o(r),{"data-field":"in_smena",caption:"Доступное время в пересменку"}),s(o(r),{"data-field":"in_not_excavator_move",caption:"Вне геозоны ЭКС, в движении (мин)"}),s(o(r),{"data-field":"in_not_excavator_stop",caption:"Вне геозоны ЭКС, в ожидании (мин)"})]),_:1},8,["data-source","onExporting"])):$("",!0)])])],32)],32))}}),J={class:"fixed inset-0"},K=t("i",{class:"fa-duotone fa-house"},null,-1),O={class:"absolute bottom-3 left-0 p-2 z-50"},ne=h({__name:"GreydersPage",setup(M){const m=c(),i=c(!1),u=B(p()),a=Y({currentDate:u.date,wialon:null,geozones:null,leaflet:null,selected:null,loading:!1,smena:u.smena});function _(n){a.smena=n,d()}async function d(){a.loading=!0;const n=E(a.currentDate,a.smena),e=n.start,l=n.end;await a.wialon.greyderReport(e,l),a.loading=!1}return y(async()=>{a.leaflet=new H(m.value),a.wialon=new z(a.leaflet.map),a.wialon.onInit=()=>d()}),(n,e)=>{const l=V("RouterLink");return x(),k("section",J,[s(G,{loading:a.loading},null,8,["loading"]),i.value?(x(),D(q,{key:0,onClose:e[0]||(e[0]=f=>i.value=!1)})):$("",!0),s(l,{to:"/",class:"absolute left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:C(()=>[K]),_:1}),t("div",O,[g(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=f=>a.currentDate=f),onChange:d,class:"px-4 py-1.5 rounded-full shadow-sm"},null,544),[[w,a.currentDate]]),t("button",{class:b([{"!bg-teal-600 !text-white":a.smena==1},"bg-white px-4 ml-2 py-1.5 rounded-full"]),onClick:e[2]||(e[2]=f=>_(1))},"1 Smena",2),t("button",{class:b([{"!bg-teal-600 !text-white":a.smena==2},"bg-white px-4 ml-2 py-1.5 rounded-full"]),onClick:e[3]||(e[3]=f=>_(2))},"2 Smena",2),t("button",{onClick:e[4]||(e[4]=f=>i.value=!0),class:"bg-white px-4 ml-2 py-1.5 rounded-full"},"Контроль зачистки забоя в пересменку")]),t("div",{ref_key:"geozonemap",ref:m,class:"h-full w-full z-40"},null,512)])}}});export{ne as default};
