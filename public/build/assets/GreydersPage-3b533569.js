import{d as z,A as L,e as _,B as V,C as P,r as Y,D as F,h as E,o as f,c as x,a as n,t as k,u as m,b as d,n as $,y as D,m as S,g as N,p as B,w as M,k as T,E as U,f as G,v as R}from"./app-94c5476c.js";import{h as w,W as j}from"./Wialon-c6709491.js";import{g as A,a as W,b as I}from"./TimezoneDate-25e384e0.js";import{D as q,a as b,o as H,b as J}from"./data-grid-ae749bd4.js";import{L as K,_ as O}from"./PreLoader.vue_vue_type_script_setup_true_lang-ab5c53c6.js";import"./_commonjsHelpers-de833af9.js";const Q={class:"relative"},X={key:0},Z={key:1},ee={key:0,class:"absolute inset-0 bg-black/40 z-50 flex justify-center items-center"},te={class:"bg-white p-4 text-center rounded"},ae=n("h3",{class:"mb-4 font-semibold"},"Выберите смену",-1),ne=n("span",{class:"mr-4"},null,-1),oe=z({__name:"PeriodPicker",props:{day:{},dayModifiers:{},smena:{},smenaModifiers:{}},emits:L(["submit"],["update:day","update:smena"]),setup(h,{emit:g}){const i=g,c=_(!1),t=_(null),r=_(null),v=V(h,"day"),p=V(h,"smena"),l=_([{start:new Date(new Date().getTime()+24*60*60*1e3),end:null}]);function u(){t.value=null,r.value=null}const a=_([{key:"today",highlight:!0,dates:v}]);return P(()=>r.value,()=>{t.value==null||r.value==null||(v.value=t.value,p.value=r.value,c.value=!1,i("submit"))}),(e,o)=>{const s=Y("VDatePicker"),C=F("click-outside");return E((f(),x("main",Q,[n("button",{onClick:o[0]||(o[0]=y=>c.value=!0),class:"px-4 py-1.5 bg-slate-900 text-white rounded shadow-md"},[v.value==null&&p.value==null?(f(),x("span",X," Выберите Дату ")):(f(),x("span",Z,k(m(w)(v.value).format("YYYY-MM-DD"))+" СМЕНА : "+k(p.value),1))]),c.value?(f(),x("div",{key:0,onVnodeMounted:u,class:"absolute bg-white z-50 top-11 left-0"},[d(s,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=y=>t.value=y),mode:"date",attributes:a.value,"disabled-dates":l.value},null,8,["modelValue","attributes","disabled-dates"]),t.value?(f(),x("main",ee,[n("aside",te,[ae,n("button",{class:$([{"bg-slate-900 !text-white":r.value==1},"bg-gray-200 text-black w-10 h-10 rounded shadow-sm"]),onClick:o[2]||(o[2]=y=>r.value=1)},"1",2),ne,n("button",{class:$([{"bg-slate-900 !text-white":r.value==2},"bg-gray-200 text-black w-10 h-10 rounded shadow-sm"]),onClick:o[3]||(o[3]=y=>r.value=2)},"2",2)])])):D("",!0)],512)):D("",!0)])),[[C,()=>c.value=!1]])}}}),se={class:"flex justify-end items-center px-2 bg-slate-900 text-white"},le=n("i",{class:"fa-regular fa-xmark"},null,-1),ie=[le],ue={class:"flex-grow relative"},re={class:"absolute inset-0 overflow-y-auto"},de={class:"flex pt-2 px-2 items-start"},ce={key:0,style:{color:"red"}},me={key:1,style:{color:"green"}},ve={class:"absolute bottom-0 w-full bg-gray-100 px-2 py-1.5 text-xl uppercase"},pe=n("br",null,null,-1),_e=z({__name:"GrayderModal",setup(h){const g=_(),i=_([]),c=_(null),t=_(null);g.value=new j;const r=A();c.value=r.date,t.value=r.smena;async function v(){i.value=[];const u=w(c.value).format("YYYY-MM-DD"),a=t.value==1?{start:"08:30",end:"09:40"}:{start:"20:30",end:"21:40"},e=await g.value.greyderTable(10587,w(`${u} ${a.start}`).unix(),w(`${u} ${a.end}`).unix());for(const s in e){const C=[...e[s].counts];var o="";C.forEach(y=>{o+=`${y.replace("РВ Экскаватор","")} `}),i.value.push({name:s,in_excavator:(e[s].time_in_excavator/60).toFixed(1),counts:e[s].counts.size,excavator_names:o,active:e[s].in_not_excavator_move==0&&e[s].in_not_excavator_stop==0&&e[s].time_in_excavator==0,in_smena:"08:30 - 09:40 | 70 мин",in_not_excavator_move:(e[s].in_not_excavator_move/60).toFixed(1),in_not_excavator_stop:(e[s].in_not_excavator_stop/60).toFixed(1),excavator_move:e[s].in_not_excavator_move,excavator_stop:e[s].in_not_excavator_stop,excalibur:e[s].time_in_excavator})}}const p=S(()=>{console.log(i.value);const u=i.value.reduce((e,o)=>o.active==!1?e+=1:e,0),a=i.value.reduce((e,o)=>o.count!=0?e+=o.counts:e,0);return(a+u==0?0:a/u).toFixed(1)}),l=S(()=>{const a=i.value.reduce((o,s)=>s.active==!1?o+=1:o,0)*70*60,e=i.value.reduce((o,s)=>s.excavator_stop!=0?o+=s.excavator_stop:o,0);return isNaN(e/a)?0:Math.round(e/a*100)});return N(()=>{v()}),(u,a)=>(f(),x("section",{onMouseup:a[4]||(a[4]=e=>u.$emit("close")),class:"absolute inset-0 bg-black/40 z-[100] flex justify-center items-center p-10"},[n("main",{onMouseup:a[3]||(a[3]=U(()=>{},["stop"])),class:"bg-white w-full h-full rounded-md flex flex-col overflow-hidden relative"},[n("header",se,[n("div",null,[n("button",{onClick:a[0]||(a[0]=e=>u.$emit("close")),class:"w-10 h-10 flex justify-center items-center active:bg-white/15 hover:bg-white/25"},ie)])]),n("main",ue,[n("div",re,[n("div",de,[d(oe,{day:c.value,"onUpdate:day":a[1]||(a[1]=e=>c.value=e),smena:t.value,"onUpdate:smena":a[2]||(a[2]=e=>t.value=e),onSubmit:v},null,8,["day","smena"])]),i.value.length?(f(),B(m(J),{key:0,"data-source":i.value,onExporting:m(H)},{"grid-cell":M(({data:e})=>[e.data.active?(f(),x("div",ce,"В ремонте")):(f(),x("div",me,"В работе"))]),default:M(()=>[d(m(q),{enabled:!0,"allow-export-selected-data":!0}),d(m(b),{"data-field":"name",caption:"Техника",width:"120"}),d(m(b),{"data-field":"active","cell-template":"grid-cell"}),d(m(b),{"data-field":"counts",caption:"Кол-во зачищенных забоев",width:"200"}),d(m(b),{"data-field":"excavator_names",caption:"Экскаватор",width:"130"}),d(m(b),{"data-field":"in_smena",caption:"Доступное время в пересменку ЭКС",width:"260"}),d(m(b),{"data-field":"in_excavator",caption:"Время в геозоне ЭКС (мин)"}),d(m(b),{"data-field":"in_not_excavator_move",caption:"Вне геозоны ЭКС, в движении (мин)"}),d(m(b),{"data-field":"in_not_excavator_stop",caption:"Вне геозоны ЭКС, без движении (мин)"})]),_:1},8,["data-source","onExporting"])):D("",!0)]),n("div",ve,[T(" количество зачищенных забоев на 1 ед. работающей техники - "+k(p.value)+" ",1),pe,T(" время вне геозоны в ожидании, % от доступного времени - "+k(l.value)+"% ",1)])])],32)],32))}}),fe={class:"fixed inset-0"},xe=n("i",{class:"fa-duotone fa-house"},null,-1),be={class:"absolute bottom-3 left-0 p-2 z-50"},De=z({__name:"GreydersPage",setup(h){const g=_(),i=_(!1),c=W(w()),t=G({currentDate:c.date,wialon:null,geozones:null,leaflet:null,selected:null,loading:!1,smena:c.smena});function r(p){t.smena=p,v()}async function v(){t.loading=!0;const p=I(t.currentDate,t.smena),l=p.start,u=p.end;await t.wialon.greyderReport(l,u),t.loading=!1}return N(async()=>{t.leaflet=new K(g.value),t.wialon=new j(t.leaflet.map),t.wialon.onInit=()=>v()}),(p,l)=>{const u=Y("RouterLink");return f(),x("section",fe,[d(O,{loading:t.loading},null,8,["loading"]),i.value?(f(),B(_e,{key:0,onClose:l[0]||(l[0]=a=>i.value=!1)})):D("",!0),d(u,{to:"/",class:"absolute left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:M(()=>[xe]),_:1}),n("div",be,[E(n("input",{type:"date","onUpdate:modelValue":l[1]||(l[1]=a=>t.currentDate=a),onChange:v,class:"px-4 py-1.5 rounded-full shadow-sm"},null,544),[[R,t.currentDate]]),n("button",{class:$([{"!bg-teal-600 !text-white":t.smena==1},"bg-white px-4 ml-2 py-1.5 rounded-full"]),onClick:l[2]||(l[2]=a=>r(1))},"1 Smena",2),n("button",{class:$([{"!bg-teal-600 !text-white":t.smena==2},"bg-white px-4 ml-2 py-1.5 rounded-full"]),onClick:l[3]||(l[3]=a=>r(2))},"2 Smena",2),n("button",{onClick:l[4]||(l[4]=a=>i.value=!0),class:"bg-white px-4 ml-2 py-1.5 rounded-full"},"Контроль зачистки забоя в пересменку")]),n("div",{ref_key:"geozonemap",ref:g,class:"h-full w-full z-40"},null,512)])}}});export{De as default};
