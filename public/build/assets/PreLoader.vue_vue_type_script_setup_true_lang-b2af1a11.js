import{u as p}from"./Wialon-f2b3155b.js";import{d as g,o as u,p as _,w as f,c as k,y as w,T as y,a as v}from"./app-50a67d41.js";class B{constructor(e){this.points=[],this.store=p(),this.map=this.createMap(e)}createMap(e){const s=wialon.core.Session.getInstance().getId(),t=wialon.core.Session.getInstance(),o=L.map(e,{zoomControl:!1}).setView([42.2628699,63.891215],12);L.TileLayer.WebGis=L.TileLayer.extend({initialize:function(a,n){this._url=`http://wl.ngmk.uz/gis_render/{x}_{y}_{z}/${n.userId}/tile.png?sid=${s}`},getTileUrl:r}),new L.TileLayer.WebGis(t.getBaseGisUrl("render"),{attribution:"NKMK SHKB",minZoom:1,userId:t.getCurrUser().getId()}).addTo(o);function r(a){return L.Util.template(this._url,L.extend({s:this._getSubdomain(a),z:17-a.z,x:a.x,y:a.y},this.options))}return o}drawSquare(e,s,t){const o=+e.ZonaX,r=+e.ZonaY,a=42.32,n=63.82,c=L.latLng(a-o*(s/111e3),n+r*(s/(111e3*Math.cos(this.deg2rad(a))))),l=L.latLng(a-(o+1)*(s/111e3),n+(r+1)*(s/(111e3*Math.cos(this.deg2rad(a))))),m=this.getCenterCubic(c,l),d=L.rectangle([c,l],{color:"black",weight:1,opacity:1,fillOpacity:.25}).addTo(this.map),h=L.marker(m,{icon:L.divIcon({className:"custom-marker-class",html:t})}).addTo(this.map);this.points.push({rect:d,marker:h}),this.store.points.push({center:m,item:e,image:h._icon,active:!1,index:t}),d.on("click",function(x){})}getCenterCubic(e,s){const t=(e.lat+s.lat)/2,o=(e.lng+s.lng)/2;return L.latLng(t,o)}drawCubics(e){e.forEach((s,t)=>{this.drawSquare(s,50,t+1)})}removeCubics(){this.points.forEach(e=>{this.map.removeLayer(e.rect),this.map.removeLayer(e.marker)}),this.store.points=[],this.points=[]}deg2rad(e){return e*(Math.PI/180)}fixedToPoint(e,s){this.store.points.forEach(t=>{t.image==s?(t.active=!0,t.image.classList.add("animate-marker")):(t.active=!1,t.image.classList.remove("animate-marker"))}),this.map.setView(e,15)}}const b={key:0,class:"bg-black/30 absolute inset-0 z-[100] flex justify-center items-center"},C=v("span",{class:"loader"},null,-1),T=[C],M=g({__name:"PreLoader",props:["loading"],setup(i){const e=i;return(s,t)=>(u(),_(y,null,{default:f(()=>[e.loading?(u(),k("div",b,T)):w("",!0)]),_:1}))}});export{B as L,M as _};
