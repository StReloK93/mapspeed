import{bF as v,d as _,e as u,g as x,o as y,c as b,f as C,r as g,b as f,w as k,a as c}from"./app-4370138c.js";import{h as r,W as L}from"./Wialon-91e93c25.js";import{H as W}from"./highcharts-ba9c9956.js";import{L as z,_ as Y}from"./PreLoader.vue_vue_type_script_setup_true_lang-723a80a8.js";import{a as M}from"./TimezoneDate-6511d812.js";import"./_commonjsHelpers-de833af9.js";async function R(p){const{data:o}=await v.post("api/get_way_speed",p);return o}const S={getWaysSpeed:R},V=_({__name:"ChartLine",setup(p,{expose:o}){function d(s){const t=new Date(s);return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes())}function e(s){n.value.series[0].setData(s.map(t=>({y:t.average_speed,x:d(t.hour)})))}const l=u(),n=u(null),m={accessibility:{enabled:!1},chart:{backgroundColor:"transparent",type:"spline",scrollablePlotArea:{}},title:null,subtitle:null,xAxis:{gridLineColor:"transparent",gridLineWidth:0,lineWidth:0,minorGridLineWidth:10,type:"datetime",labels:{overflow:"justify"}},yAxis:{min:0,max:50,title:null,minorGridLineWidth:0,gridLineWidth:0,alternateGridColor:null},tooltip:{valueSuffix:" Km/s"},plotOptions:{spline:{lineWidth:4,states:{hover:{lineWidth:5}},marker:{enabled:!1},pointInterval:36e5,pointStart:Date.UTC(2020,3,15,0,0,0)}},series:[{name:"Tezlik smena bo'yicha",data:[]}],navigation:{menuItemStyle:{fontSize:"10px"}}};return o({getChartData:e}),x(()=>{n.value=W.chart(l.value,m)}),(s,t)=>(y(),b("main",{class:"h-64 w-full",ref_key:"chartLine",ref:l},null,512))}}),P={class:"fixed inset-0"},T=c("i",{class:"fa-duotone fa-house"},null,-1),U={class:"absolute top-0 right-0 p-2 z-50 flex w-96 flex-col bg-blue-200/50 rounded-b-2xl"},N=_({__name:"WaysPage",setup(p){const o=u(),d=M(r()),e=C({currentDate:d.date,wialon:null,geozones:null,leaflet:null,loading:!1,smena:d.smena}),l=u(),n=u({start:null,end:null});function m(){var a;l.value.getChartData([]),(a=e.leaflet)==null||a.rectanglesClear()}async function s(){const a=e.leaflet.getRectanglePoints(),i=await S.getWaysSpeed({startDay:r(n.value.start).format("YYYY-MM-DD"),endDay:r(n.value.end).format("YYYY-MM-DD"),points:a});l.value.getChartData(i)}async function t(a){e.loading=!0;const i=r(a).add(-6,"h").unix(),h=r(a).unix();await e.wialon.executeReport(7381,i,h),e.loading=!1}return x(async()=>{e.leaflet=new z(o.value,!0),e.wialon=new L(e.leaflet.map),e.wialon.onInit=()=>t(new Date)}),(a,i)=>{const h=g("RouterLink"),w=g("VDatePicker");return y(),b("section",P,[f(Y,{loading:e.loading},null,8,["loading"]),f(h,{to:"/",class:"absolute left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:k(()=>[T]),_:1}),c("div",U,[c("button",{onClick:m,class:"bg-white px-4 py-1.5 rounded-full mb-2"},"Tozalash"),f(V,{ref_key:"chartLineRef",ref:l},null,512),f(w,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=D=>n.value=D),mode:"date",class:"my-2","is-range":"",expanded:""},null,8,["modelValue"]),c("button",{onClick:s,class:"px-4 py-1.5 rounded-full bg-blue-500 text-white"},"Tasdiqlash")]),c("div",{ref_key:"geozonemap",ref:o,class:"h-full w-full z-40"},null,512)])}}});export{N as default};
