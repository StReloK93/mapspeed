import{d as k,g as D,h as C,i as T,c as i,f as _,w as E,a,j as M,v as Y,F as R,k as N,r as V,o as r,n as j,t as w,u as y,l as b}from"./app-736814d1.js";import{h as c,W as B}from"./Wialon-127f7356.js";import{L as G,_ as H}from"./PreLoader.vue_vue_type_script_setup_true_lang-1361873c.js";const I={class:"fixed inset-0"},$=a("i",{class:"fa-duotone fa-house"},null,-1),A={class:"absolute bottom-[105px] left-0 p-2 z-50"},O={class:"absolute left-0 bottom-0 z-50 w-full p-2"},S={class:"flex flex-wrap gap-1 justify-between px-6 items-center h-24 bg-white relative rounded-md shadow-md"},F=a("span",{class:"border-b w-full absolute top-1/2 left-0 border-gray-400"},null,-1),P={class:"inline-flex w-4 h-4 justify-center items-center relative z-20"},W=["onClick"],U={key:0,class:"text-[11px] font-bold relative -top-px"},X={key:1},q={key:0,class:"fa-solid fa-circle-small text-sm"},J={key:1,class:"fa-light fa-pipe text-[10px]"},te=k({__name:"GeozonesPage",setup(K){const f=D(),e=C({currentDate:c().format("YYYY-MM-DD"),wialon:null,geozones:null,leaflet:null,selected:null,loading:!1});async function x(n){const{data:o}=await axios.get(`api/get_geozones/${n}`),s=[];for(const t in o)s.push({dateTime:c(t).format("YYYY-MM-DD HH:mm"),points:o[t],zero:c(t).format("mm")=="00"});return s}const d=[];function z(){d.forEach(n=>{e.leaflet.map.removeLayer(n)})}function m(n){const o=e.geozones[n];v(o.dateTime),z(),e.geozones.length!=0&&(e.selected=n,o.points.forEach(s=>{const t=s.name,l={color:"#333",weight:3,fillColor:"red",fillOpacity:.5};if(s.points.length>1){const p=s.points.map(h=>[h.y,h.x]),u=L.polygon(p,l).addTo(b(e.leaflet.map));u.bindTooltip(t),d.push(u)}else{const p=s.points[0],u=L.circle([p.y,p.x],{radius:p.r,...l}).addTo(b(e.leaflet.map));u.bindTooltip(t),d.push(u)}}))}async function v(n){e.loading=!0;const o=c(n).add(-1.5,"h").unix(),s=c(n).unix();await e.wialon.executeReport(ENV.BASE_ALLCARS_ID,o,s,ENV.REPORT_INDEX),e.loading=!1}async function g(){e.geozones=await x(e.currentDate),m(e.geozones.length-1)}return T(async()=>{e.leaflet=new G(f.value),e.wialon=new B(e.leaflet.map),e.wialon.onInit=()=>g()}),(n,o)=>{const s=V("RouterLink");return r(),i("section",I,[_(H,{loading:e.loading},null,8,["loading"]),_(s,{to:"/",class:"absolute left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:E(()=>[$]),_:1}),a("div",A,[M(a("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=t=>e.currentDate=t),onChange:o[1]||(o[1]=t=>g()),class:"px-4 py-1.5 rounded-full"},null,544),[[Y,e.currentDate]])]),a("aside",O,[a("main",S,[F,(r(!0),i(R,null,N(e.geozones,(t,l)=>(r(),i("span",P,[a("button",{onClick:p=>m(l),class:j([{"!bottom-4":l%2==1,"top-4":l%2==0,"text-xs w-7 h-7 bg-gray-200":t.zero==!1,"w-9 h-9 bg-gray-300":t.zero,"!bg-blue-600 text-white":e.selected==l},"absolute rounded-full hover:bg-gray-100 active:bg-gray-50 shadow-sm"])},[t.zero?(r(),i("span",U,w(y(c)(t.dateTime).format("HH:mm")),1)):(r(),i("span",X,w(y(c)(t.dateTime).format("mm")),1))],10,W),t.zero?(r(),i("i",q)):(r(),i("i",J))]))),256))])]),a("div",{ref_key:"geozonemap",ref:f,class:"h-full w-full z-40"},null,512)])}}});export{te as default};
