import{bF as D,d as x,e as u,g as v,o as m,c as g,f as k,r as y,b as p,w as C,a as c}from"./app-401b6e57.js";import{h as r,W as L}from"./Wialon-09196cd8.js";import{H as W}from"./highcharts-ba9c9956.js";import{L as Y,_ as z}from"./PreLoader.vue_vue_type_script_setup_true_lang-30bc5399.js";import{a as M}from"./TimezoneDate-e8454333.js";import"./_commonjsHelpers-de833af9.js";async function R(h){const{data:o}=await D.post("api/get_way_speed",h);return o}const S={getWaysSpeed:R},V=x({__name:"ChartLine",setup(h,{expose:o}){function d(l){const t=new Date(l);return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes())}function e(l){l&&a.value.series[0].setData(l.map(t=>({y:t.average_speed,x:d(t.hour)})))}const s=u(),a=u(null),_={accessibility:{enabled:!1},chart:{backgroundColor:"transparent",type:"spline",scrollablePlotArea:{}},title:null,subtitle:null,xAxis:{gridLineColor:"transparent",gridLineWidth:0,lineWidth:0,minorGridLineWidth:10,type:"datetime",labels:{overflow:"justify"}},yAxis:{min:0,max:50,title:null,minorGridLineWidth:0,gridLineWidth:0,alternateGridColor:null},tooltip:{valueSuffix:" Km/s"},plotOptions:{spline:{lineWidth:4,states:{hover:{lineWidth:5}},marker:{enabled:!1},pointInterval:36e5,pointStart:Date.UTC(2020,3,15,0,0,0)}},series:[{name:"Tezlik smena bo'yicha",data:[]}],navigation:{menuItemStyle:{fontSize:"10px"}}};return o({getChartData:e}),v(()=>{a.value=W.chart(s.value,_)}),(l,t)=>(m(),g("main",{class:"h-64 w-full",ref_key:"chartLine",ref:s},null,512))}}),P={class:"fixed inset-0"},T=c("i",{class:"fa-duotone fa-house"},null,-1),U={class:"absolute top-0 right-0 p-2 z-50 flex w-96 flex-col bg-blue-200/50 rounded-b-2xl"},A={key:0,class:"fa-sharp fa-regular fa-spinner fa-spin-pulse"},B={key:1},O=x({__name:"WaysPage",setup(h){const o=u(),d=M(r()),e=k({currentDate:d.date,wialon:null,geozones:null,leaflet:null,loading:!1,smena:d.smena}),s=u(),a=u({start:null,end:null});function _(){var n;s.value.getChartData([]),(n=e.leaflet)==null||n.rectanglesClear()}async function l(){e.loading=!0;const n=e.leaflet.getRectanglePoints(),i=await S.getWaysSpeed({startDay:r(a.value.start).format("YYYY-MM-DD"),endDay:r(a.value.end).format("YYYY-MM-DD"),points:n}).catch(f=>{a.value.start==null&&a.value.end==null&&alert("Kunni tanlang"),n.length==0&&alert("Yo'lni tanlang"),e.loading=!1});s.value.getChartData(i),e.loading=!1}async function t(n){e.loading=!0;const i=r(n).add(-6,"h").unix(),f=r(n).unix();await e.wialon.executeReport(7381,i,f),e.loading=!1}return v(async()=>{e.leaflet=new Y(o.value,!0),e.wialon=new L(e.leaflet.map),e.wialon.onInit=()=>t(new Date)}),(n,i)=>{const f=y("RouterLink"),b=y("VDatePicker");return m(),g("section",P,[p(z,{loading:e.loading},null,8,["loading"]),p(f,{to:"/",class:"absolute left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:C(()=>[T]),_:1}),c("div",U,[c("button",{onClick:_,class:"bg-white px-4 py-1.5 rounded-full mb-2"},"Tozalash"),p(V,{ref_key:"chartLineRef",ref:s},null,512),p(b,{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=w=>a.value=w),mode:"date",class:"my-2","is-range":"",expanded:""},null,8,["modelValue"]),c("button",{onClick:l,class:"px-4 py-1.5 rounded-full bg-blue-500 text-white"},[e.loading?(m(),g("i",A)):(m(),g("span",B,"Tasdiqlash"))])]),c("div",{ref_key:"geozonemap",ref:o,class:"h-full w-full z-40"},null,512)])}}});export{O as default};
