import{d as k,e as D,f as C,g as T,r as M,o as i,c as r,b as _,w as Y,a,h as j,v as G,F as H,i as R,n as $,t as w,u as y,j as b}from"./app-5e9f9567.js";import{h as c,W as B}from"./Wialon-a2e0a235.js";import{L as E,_ as V}from"./PreLoader.vue_vue_type_script_setup_true_lang-8362e1f3.js";const F={class:"fixed inset-0"},I=a("i",{class:"fa-duotone fa-house"},null,-1),N={class:"absolute bottom-[105px] left-0 p-2 z-50"},O={class:"absolute left-0 bottom-0 z-50 w-full p-2"},W={class:"flex flex-wrap gap-1 justify-between px-6 items-center h-24 bg-white relative rounded-md shadow-md"},P=a("span",{class:"border-b w-full absolute top-1/2 left-0 border-gray-400"},null,-1),S={class:"inline-flex w-4 h-4 justify-center items-center relative z-20"},U=["onClick"],q={key:0,class:"text-[11px] font-bold relative -top-px"},A={key:1},J={key:0,class:"fa-solid fa-circle-small text-sm"},K={key:1,class:"fa-light fa-pipe text-[10px]"},te=k({__name:"GeozonesPage",setup(Q){const f=D(),e=C({currentDate:c().format("YYYY-MM-DD"),wialon:null,geozones:null,leaflet:null,selected:null,loading:!1});async function x(n){const{data:o}=await axios.get(`api/get_geozones/${n}`),s=[];for(const t in o)s.push({dateTime:c(t).format("YYYY-MM-DD HH:mm"),points:o[t],zero:c(t).format("mm")=="00"});return s}const d=[];function z(){d.forEach(n=>{e.leaflet.map.removeLayer(n)})}function m(n){const o=e.geozones[n];v(o.dateTime),z(),e.geozones.length!=0&&(e.selected=n,o.points.forEach(s=>{const t=s.name,l={color:"#333",weight:3,fillColor:"red",fillOpacity:.5};if(s.points.length>1){const p=s.points.map(h=>[h.y,h.x]),u=L.polygon(p,l).addTo(b(e.leaflet.map));u.bindTooltip(t),d.push(u)}else{const p=s.points[0],u=L.circle([p.y,p.x],{radius:p.r,...l}).addTo(b(e.leaflet.map));u.bindTooltip(t),d.push(u)}}))}async function v(n){e.loading=!0;const o=c(n).add(-1.5,"h").unix(),s=c(n).unix();await e.wialon.executeReport(7381,o,s),e.loading=!1}async function g(){e.geozones=await x(e.currentDate),m(e.geozones.length-1)}return T(async()=>{e.leaflet=new E(f.value),e.wialon=new B(e.leaflet.map),e.wialon.onInit=()=>g()}),(n,o)=>{const s=M("RouterLink");return i(),r("section",F,[_(V,{loading:e.loading},null,8,["loading"]),_(s,{to:"/",class:"absolute left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:Y(()=>[I]),_:1}),a("div",N,[j(a("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=t=>e.currentDate=t),onChange:o[1]||(o[1]=t=>g()),class:"px-4 py-1.5 rounded-full"},null,544),[[G,e.currentDate]])]),a("aside",O,[a("main",W,[P,(i(!0),r(H,null,R(e.geozones,(t,l)=>(i(),r("span",S,[a("button",{onClick:p=>m(l),class:$([{"!bottom-4":l%2==1,"top-4":l%2==0,"text-xs w-7 h-7 bg-gray-200":t.zero==!1,"w-9 h-9 bg-gray-300":t.zero,"!bg-blue-600 text-white":e.selected==l},"absolute rounded-full hover:bg-gray-100 active:bg-gray-50 shadow-sm"])},[t.zero?(i(),r("span",q,w(y(c)(t.dateTime).format("HH:mm")),1)):(i(),r("span",A,w(y(c)(t.dateTime).format("mm")),1))],10,U),t.zero?(i(),r("i",J)):(i(),r("i",K))]))),256))])]),a("div",{ref_key:"geozonemap",ref:f,class:"h-full w-full z-40"},null,512)])}}});export{te as default};
