import{d as w,o as l,c as d,h as L,v as M,a as t,n as v,G as b,e as N,f as S,g as T,r as R,b as y,w as k,t as O,E as p,k as V,y as W,T as Y,F as B,i as I,p as C,u as q}from"./app-ce6a0468.js";import{W as F,h as P}from"./Wialon-fdf32d97.js";import{L as U,_ as j}from"./PreLoader.vue_vue_type_script_setup_true_lang-ac9f4858.js";const G={class:"flex-grow"},H=["disabled"],A=w({__name:"OrderNameInput",props:["pageData","order"],setup(a){const i=a;return(e,r)=>(l(),d("div",G,[L(t("input",{type:"text",disabled:i.pageData.editable!=a.order,"onUpdate:modelValue":r[0]||(r[0]=u=>i.order.name=u),class:"w-full h-full bg-gray-100 px-2 rounded outline-none disabled:bg-transparent",required:""},null,8,H),[[M,i.order.name]])]))}}),J={class:"flex gap-1.5"},K=t("button",{type:"submit",class:"w-7 h-7 text-sm bg-teal-500/20 text-teal-900 rounded active:bg-teal-500/50 hover:bg-teal-500/30"},[t("i",{class:"fa-solid fa-floppy-disk"})],-1),Q=t("i",{class:"fa-duotone fa-solid fa-trash"},null,-1),X=[Q],Z=w({__name:"NewOrderEvents",emits:["delete"],setup(a,{emit:i}){const e=i;return(r,u)=>(l(),d("div",J,[K,t("button",{onClick:u[0]||(u[0]=c=>e("delete")),type:"button",class:"w-7 h-7 text-sm bg-red-500/15 text-red-900 rounded active:bg-red-500/50 hover:bg-red-500/30"},X)]))}}),ee={class:"flex gap-1.5"},te=["disabled"],se=t("i",{class:"fa-solid fa-map"},null,-1),ae=[se],oe={key:0,type:"submit",class:"w-7 h-7 text-sm bg-teal-500/15 text-teal-900 rounded active:bg-teal-500/50 hover:bg-teal-500/30"},ne=t("i",{class:"fa-solid fa-floppy-disk"},null,-1),le=[ne],ie=t("i",{class:"fa-solid fa-pencil"},null,-1),de=[ie],re=t("i",{class:"fa-duotone fa-solid fa-trash"},null,-1),ce=[re],ue=w({__name:"ExistOrderEvents",props:["pageData","order"],emits:["deleteOrderWay","editExistsOrder","selectedWayChange"],setup(a,{emit:i}){const e=a,r=i;return(u,c)=>(l(),d("div",ee,[t("button",{type:"button",onClick:c[0]||(c[0]=x=>r("selectedWayChange")),disabled:e.pageData.selectedLoading==e.order,class:v([[e.pageData.selectedLoading==a.order?"bg-teal-900 text-white":"bg-teal-500/15 text-teal-900 active:bg-teal-500/50 hover:bg-teal-500/30"],"w-7 h-7 text-sm rounded"])},ae,10,te),e.pageData.editable==e.order?(l(),d("button",oe,le)):(l(),d("button",{key:1,type:"button",onClick:c[1]||(c[1]=x=>r("editExistsOrder")),class:"w-7 h-7 text-sm bg-teal-500/15 text-teal-900 rounded active:bg-teal-500/50 hover:bg-teal-500/30"},de)),t("button",{onClick:c[2]||(c[2]=x=>r("deleteOrderWay")),type:"button",class:"w-7 h-7 text-sm bg-red-500/15 text-red-900 rounded active:bg-red-500/50 hover:bg-red-500/30"},ce)]))}}),g="api/orderway";async function fe(){return await b.get(g)}async function pe(a){return await b.get(`${g}/${a}`)}async function be(a){return b.post(g,a)}async function ge(a,i){return b.put(`${g}/${a}`,i)}async function _e(a){return b.post(`${g}/${a.id}/update-name`,a)}async function me(a){return b.delete(`${g}/${a}`)}const m={index:fe,store:be,update:ge,destroy:me,updateName:_e,show:pe},xe={class:"h-full flex fixed inset-0"},he=t("i",{class:"fa-duotone fa-house"},null,-1),ye={class:"absolute top-3 right-20 text-xl text-teal-600 z-[1000] font-semibold"},ve=t("i",{class:"fa-solid fa-xmark"},null,-1),we=[ve],$e=t("i",{class:"fa-solid fa-broom-wide"},null,-1),ke=[$e],Oe={key:0,class:"fa-solid fa-spinner fa-spin-pulse"},We={key:1},Ce=t("i",{class:"fa-solid fa-floppy-disk ml-1.5"},null,-1),De=t("main",{class:"text-center text-white"},[t("h3",{class:"text-3xl mb-3 uppercase"},"Hisobotni tanlang"),t("span",{class:"text-6xl"},[t("i",{class:"fa-solid fa-map"})])],-1),Ee=[De],ze={class:"p-2 z-50 h-full flex w-[420px] flex-col bg-white"},Le=["disabled"],Me={class:"mt-1.5"},Ne={class:""},Se=["onSubmit"],Te={key:0,class:"px-2 mb-1.5"},Re={class:"text-sm text-gray-400"},Ie=w({__name:"WaysRedactor",setup(a){const i=N(null),e=S({wialon:null,leaflet:null,loading:!1,selectedOrderWay:null,selectedLoading:null,orders:[],editable:null});function r(){e.orders.unshift({name:"",edit:null}),e.editable=e.orders[0]}function u(o){const s=e.orders.findIndex(f=>f==o);e.orders.splice(s,1),e.editable==o&&(e.editable=null)}function c(o){e.orders=e.orders.filter(s=>s.id!==void 0),e.editable=o}async function x(o,s){if(o.preventDefault(),s.id===void 0){const{data:f}=await m.store(s);e.editable=null;const h=e.orders.findIndex(n=>n==s);e.orders[h]=f}else m.updateName(s),e.editable=null}function $(){var o;(o=e.leaflet)==null||o.rectanglesClear()}async function D(){if(e.selectedOrderWay==null)return console.log("tanlang");e.loading=!0;const o=e.leaflet.getRectanglePoints();m.update(e.selectedOrderWay.id,o),setTimeout(()=>e.loading=!1,2e3)}async function E(o){$(),e.selectedLoading=o;const{data:s}=await m.show(o.id);e.selectedOrderWay=null,setTimeout(()=>{var f;e.selectedOrderWay=o,(f=e.leaflet)==null||f.drawCubics(s.points,!1)},500)}function z(){e.selectedLoading=null,e.selectedOrderWay=null,$()}return T(async()=>{const{data:o}=await m.index();e.orders=o,e.leaflet=new U(i.value,!0),e.wialon=new F(e.leaflet.map)}),(o,s)=>{var h;const f=R("RouterLink");return l(),d("section",xe,[y(j,{loading:e.loading},null,8,["loading"]),y(f,{to:"/",class:"fixed left-3 top-3 btn-line bg-white shadow-md !text-xl z-50 text-center content-center"},{default:k(()=>[he]),_:1}),t("div",{ref_key:"geozonemap",ref:i,class:"h-full flex-grow relative z-40"},[t("h3",ye,O((h=e.selectedOrderWay)==null?void 0:h.name),1),t("div",{onClick:s[1]||(s[1]=p(()=>{},["stop"])),onMousedown:s[2]||(s[2]=p(()=>{},["stop"])),class:v([[e.selectedOrderWay!=null?"right-0":"-right-10"],"z-[1000] cursor-auto absolute bottom-0 top-0 transition-all bg-gray-50 p-2 shadow-inner border-r border-teal-400 flex flex-col gap-2"])},[t("button",{onClick:s[0]||(s[0]=n=>z()),class:"w-8 h-8 text-sm bg-red-300/20 shadow text-red-900 rounded active:bg-red-500/50 hover:bg-red-500/30"},we),t("button",{onClick:$,class:"w-8 h-8 text-sm bg-teal-300/20 shadow text-teal-900 rounded active:bg-teal-500/50 hover:bg-teal-500/30"},ke)],34),t("div",{onClick:s[3]||(s[3]=p(()=>{},["stop"])),onMousedown:s[4]||(s[4]=p(()=>{},["stop"])),class:v([[e.selectedOrderWay!=null?"bottom-0":"-bottom-10"],"z-[1000] cursor-auto absolute right-12 left-0 transition-all p-2 gap-2 text-right"])},[t("button",{onClick:D,class:"w-24 py-1.5 rounded uppercase bg-teal-400/40 text-teal-900 font-bold active:bg-teal-500/50 hover:bg-teal-500/30"},[e.loading?(l(),d("i",Oe)):(l(),d("span",We,[V("Saqlash "),Ce]))])],34),y(Y,null,{default:k(()=>[e.selectedOrderWay==null?(l(),d("div",{key:0,onClick:s[5]||(s[5]=p(()=>{},["stop"])),onMousedown:s[6]||(s[6]=p(()=>{},["stop"])),class:"absolute inset-0 z-[2000] bg-teal-600/90 flex justify-center items-center"},Ee,32)):W("",!0)]),_:1})],512),t("div",ze,[t("button",{disabled:e.editable!=null,onClick:s[7]||(s[7]=n=>r()),class:"bg-teal-500/20 text-teal-900 rounded py-1 font-semibold active:bg-teal-500/50 hover:bg-teal-500/30 disabled:bg-gray-200"}," Yangi hisobot ",8,Le),t("ul",Me,[(l(!0),d(B,null,I(e.orders,n=>(l(),d("li",Ne,[t("form",{onSubmit:_=>x(_,n),class:v([{"mb-1.5":n.id===void 0},"flex gap-1.5"])},[y(A,{pageData:e,order:n},null,8,["pageData","order"]),n.id===void 0?(l(),C(Z,{key:0,onDelete:_=>u(n)},null,8,["onDelete"])):(l(),C(ue,{key:1,pageData:e,order:n,onDeleteOrderWay:_=>u(n),onEditExistsOrder:_=>c(n),onSelectedWayChange:_=>E(n)},null,8,["pageData","order","onDeleteOrderWay","onEditExistsOrder","onSelectedWayChange"]))],42,Se),n.id?(l(),d("main",Te,[t("span",Re,O(q(P)(n.created_at).format("DD-MM-YYYY")),1)])):W("",!0)]))),256))])])])}}});export{Ie as default};
